#--------------------------------------------------------------------------------
#1 - one sided test
#--------------------------------------------------------------------------------
ts <- (12-10)*sqrt(100)/4
r <- ts > qnorm(.95)

#--------------------------------------------------------------------------------
#2 - 2 sided test - 2-sample paired - mean reduction (x2 < x1 => x2-x1 < 0 => left tail)
#--------------------------------------------------------------------------------
n <- 5
x1 <- c(140,138,150,148,135)
x2 <- c(132,135,151,146,130)
d <- x2-x1

d_bar <- mean(d)
d_sd <- sd(d)

se <- d_sd/sqrt(n)
ts <- d_bar/se

ta <-  qt(.025,df=n-1)

ci <- d_bar - c(-1,1)*ta*se

r <- ts < ta
p <- pt(ts,df=n-1) * 2

# or
t.test(x2, x1, alternative = "two.sided", paired = TRUE)

#--------------------------------------------------------------------------------
#3 - 2 sided test t test, m0 threashold => (mu-m0) + c(-1,1)*t*se between crit. vals.
#--------------------------------------------------------------------------------
n <- 9
mu <- 1100
s <- 30
se <- s/sqrt(9)

critical.vals <- c(-1,1)*qt(.975, df=n-1)
r <- mu + critical.vals * se

#--------------------------------------------------------------------------------
#4 - 2 sided z test - 2-sample independent  
#    x1 = new, x2 = old, decrease in the mean MWT associated with the new?
#--------------------------------------------------------------------------------
n1 <- n2 <- 100

x1 <- 4
s1 <- .5

x2 <- 6
s2 <- 2

d <- x1 - x2

se <- sqrt(s1^2/n1 + s2^2/n2)
z <- d/se
r <- z < qnorm(.025)
ci <- d + c(-1,1)*qnorm(.025)*se

#--------------------------------------------------------------------------------
#5,6 - 2 sided t test, 2-sample independent
#      diff = followup - baseline
#--------------------------------------------------------------------------------
n1 <- n2 <- 9

x_t <- -3
s_t <- 1.5

x_p <- 1
s_p <- 1.8

d <- x_t - x_p

sp <- sqrt(((n1 - 1) * s_t^2 + (n2 - 1) * s_p^2)/(n1 + n2 - 2))
se <- sp*sqrt(1/n1 + 1/n2)

t <- d/se
ta <- qt(.025,df=n1+n2-2)
r <- t < ta
ci <- d + c(1,-1)*ta*se

#--------------------------------------------------------------------------------
#7 - 2 sided t test, 2-sample independent
#    change in BP differs for OC users compared to controls
#--------------------------------------------------------------------------------
n1 <- n2 <- 16

doc <- 11
soc <- 20

dc <- 4
sc <- 28

d <- doc-dc
sp <- sqrt(((n1 - 1) * soc^2 + (n2 - 1) * sc^2)/(n1 + n2 - 2))
se <- sp*sqrt(1/n1 + 1/n2)

ts <- d/se
p <- pt(ts,df=n1+n2-2, lower.tail=F) * 2

#--------------------------------------------------------------------------------
#8 - one sided z test, power
#--------------------------------------------------------------------------------
n <- 100
mu <- .01
s <- .04

z <- .01*sqrt(100)/s
za <- qnorm(.95)
p <- pnorm(za-z, lower.tail = F)

#--------------------------------------------------------------------------------
#9 - two sided z test, 2 independent samples
#--------------------------------------------------------------------------------
n1 <- 288
x1 <- 44
s1 <- 12

n2 <- 288
x2 <- 42.04
s2 <- 12

d <- x1-x2
sp <- sqrt(((n1 - 1) * s1^2 + (n2 - 1) * s2^2)/(n1 + n2 - 2))
se <- sp*sqrt(1/n1 + 1/n2)

ts <- d/se
p <- pt(ts,df=n1+n2-2, lower.tail=F) * 2














